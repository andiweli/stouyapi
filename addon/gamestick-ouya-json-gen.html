<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gamestick/OUYA JSON Editor</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f6f9;
        margin: 40px;
    }
    h1 {
        text-align: center;
        margin-bottom: 25px;
    }
    .actions {
        position: absolute;
        top: 20px;
        right: 40px;
    }
    button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 8px 14px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.2s;
        margin-left: 10px;
    }
    button:hover {
        background-color: #0056b3;
    }
    form {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
    }
    .subsection {
        background: #fff;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    label {
        font-weight: bold;
        display: block;
        margin-top: 10px;
    }
    input, textarea, select {
        width: 100%;
        padding: 7px;
        border-radius: 4px;
        border: 1px solid #ccc;
        margin-top: 4px;
        box-sizing: border-box;
    }
    textarea { resize: vertical; }
    .array-item {
        display: flex;
        gap: 5px;
        align-items: center;
        margin-top: 5px;
    }
    .array-item input { flex: 1; }
    .add-btn, .remove-btn {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    }
    .remove-btn { background-color: #dc3545; }
</style>
</head>
<body>

<h1>Gamestick/OUYA JSON Editor</h1>

<div class="actions">
    <input type="file" id="fileInput" accept=".json" style="display:none" onchange="loadJSON(event)">
    <button type="button" onclick="document.getElementById('fileInput').click()">JSON öffnen</button>
    <button type="button" onclick="saveJSON()">JSON speichern</button>
</div>

<form id="jsonForm">
    <!-- Spalte 1 -->
    <div class="subsection">
		<h2>game meta data</h2>
        <label>packageName</label>
        <input type="text" id="packageName">

        <label>title</label>
        <input type="text" id="title">

        <label>description</label>
        <textarea id="description" rows="15"></textarea>

        <label>player(s)</label>
        <div id="playersContainer"></div>
        <button type="button" class="add-btn" onclick="addArrayItem('playersContainer', '')">+</button>

        <label>genre(s)</label>
        <div id="genresContainer"></div>
        <button type="button" class="add-btn" onclick="addArrayItem('genresContainer', '')">+</button>
    </div>

    <!-- Spalte 2 -->
    <div class="subsection">
        <h2>releases</h2>
        <div id="releasesContainer"></div>
        <button type="button" class="add-btn" onclick="addRelease()">+</button>

		<h2>graphics</h2>
        <label>discover</label>
        <input type="text" id="discover">

        <label>media</label>
        <div id="mediaContainer"></div>
        <button type="button" class="add-btn" onclick="addMedia()">+</button>
    </div>

    <!-- Spalte 3 -->
    <div class="subsection">
        <h2>developer</h2>
        <label>name</label>
        <input type="text" id="developer_name">

        <label>website</label>
        <input type="text" id="website">

        <h2>rating</h2>
        <label>likeCount</label>
        <input type="number" id="rating_likeCount">

        <label>average</label>
        <input type="number" id="rating_average">

        <label>count</label>
        <input type="number" id="rating_count">

        <label>contentRating</label>
        <input type="text" id="contentRating">

		<h2>other details</h2>
        <label>firstPublishedAt</label>
        <input type="datetime-local" id="firstPublishedAt">

        <label>inAppPurchases</label>
        <select id="inAppPurchases">
            <option value="false">False</option>
            <option value="true">True</option>
        </select>

        <label>premium</label>
        <select id="premium">
            <option value="false">False</option>
            <option value="true">True</option>
        </select>
    </div>
</form>

<script>
function addArrayItem(containerId, value = '') {
    const div = document.createElement("div");
    div.className = "array-item";
    div.innerHTML = `
        <input type="text" value="${value}">
        <button type="button" class="remove-btn" onclick="this.parentNode.remove()">−</button>`;
    document.getElementById(containerId).appendChild(div);
}

function addRelease(data = {}) {
    const div = document.createElement("div");
    div.className = "array-item";
    div.innerHTML = `
        <div style="flex:1">
            <input placeholder="name" value="${data.name || ''}">
            <input placeholder="versionCode" value="${data.versionCode || 0}">
            <input placeholder="uuid" value="${data.uuid || ''}">
            <input placeholder="date" type="datetime-local" value="${data.date || ''}">
            <input placeholder="url" value="${data.url || ''}">
            <input placeholder="size" value="${data.size || 0}">
            <input placeholder="md5sum" value="${data.md5sum || ''}">
        </div>
        <button type="button" class="remove-btn" onclick="this.parentNode.remove()">−</button>`;
    document.getElementById("releasesContainer").appendChild(div);
}

function addMedia(data = {}) {
    const div = document.createElement("div");
    div.className = "array-item";
    div.innerHTML = `
        <div style="flex:1">
            <input placeholder="type" value="${data.type || ''}">
            <input placeholder="url" value="${data.url || ''}">
            <input placeholder="thumb" value="${data.thumb || ''}">
        </div>
        <button type="button" class="remove-btn" onclick="this.parentNode.remove()">−</button>`;
    document.getElementById("mediaContainer").appendChild(div);
}

function populateForm(data) {
    document.getElementById("packageName").value = data.packageName || '';
    document.getElementById("title").value = data.title || '';
    document.getElementById("description").value = data.description || '';
    document.getElementById("discover").value = data.discover || '';
    document.getElementById("developer_name").value = data.developer?.name || '';
    document.getElementById("contentRating").value = data.contentRating || '';
    document.getElementById("website").value = data.website || '';
    document.getElementById("firstPublishedAt").value = data.firstPublishedAt || '';
    document.getElementById("inAppPurchases").value = data.inAppPurchases ? "true" : "false";
    document.getElementById("premium").value = data.premium ? "true" : "false";
    document.getElementById("rating_likeCount").value = data.rating?.likeCount || '';
    document.getElementById("rating_average").value = data.rating?.average || '';
    document.getElementById("rating_count").value = data.rating?.count || '';

    // Arrays
    document.getElementById("playersContainer").innerHTML = '';
    (data.players || []).forEach(v => addArrayItem("playersContainer", v));
    document.getElementById("genresContainer").innerHTML = '';
    (data.genres || []).forEach(v => addArrayItem("genresContainer", v));
    document.getElementById("releasesContainer").innerHTML = '';
    (data.releases || []).forEach(r => addRelease(r));
    document.getElementById("mediaContainer").innerHTML = '';
    (data.media || []).forEach(m => addMedia(m));
}

function gatherData() {
    const getArrayValues = id => Array.from(document.querySelectorAll(`#${id} input`)).map(i => i.value);

    const releases = Array.from(document.querySelectorAll("#releasesContainer > .array-item")).map(div => {
        const inputs = div.querySelectorAll("input");
        return {
            name: inputs[0].value,
            versionCode: parseInt(inputs[1].value) || 0,
            uuid: inputs[2].value,
            date: inputs[3].value,
            url: inputs[4].value,
            size: parseInt(inputs[5].value) || 0,
            md5sum: inputs[6].value
        };
    });

    const media = Array.from(document.querySelectorAll("#mediaContainer > .array-item")).map(div => {
        const inputs = div.querySelectorAll("input");
        return { type: inputs[0].value, url: inputs[1].value || null, thumb: inputs[2].value };
    });

    return {
        packageName: document.getElementById("packageName").value,
        title: document.getElementById("title").value,
        description: document.getElementById("description").value,
        players: getArrayValues("playersContainer").map(Number),
        genres: getArrayValues("genresContainer"),
        releases,
        discover: document.getElementById("discover").value,
        media,
        developer: { name: document.getElementById("developer_name").value },
        contentRating: document.getElementById("contentRating").value,
        website: document.getElementById("website").value,
        firstPublishedAt: document.getElementById("firstPublishedAt").value,
        inAppPurchases: document.getElementById("inAppPurchases").value === "true",
        premium: document.getElementById("premium").value === "true",
        rating: {
            likeCount: parseInt(document.getElementById("rating_likeCount").value),
            average: parseInt(document.getElementById("rating_average").value),
            count: parseInt(document.getElementById("rating_count").value)
        }
    };
}

function saveJSON() {
    const data = gatherData();
    const blob = new Blob([JSON.stringify(data, null, 4)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = (data.packageName || "data") + ".json";
    a.click();
}

function loadJSON(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
        const json = JSON.parse(e.target.result);
        populateForm(json);
    };
    reader.readAsText(file);
}
</script>

</body>
</html>
